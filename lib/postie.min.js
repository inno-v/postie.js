((function(){var a,b,c,d=function(a,b){return function(){return a.apply(b,arguments)}};a=function(){function a(a){a==null&&(a={}),this.onMessage=d(this.onMessage,this),console.log("constructor..."),this}return a.prototype.listenCallback=null,a.prototype.domain="*",a.prototype.send=function(a,b,d){var e;return e=new c(a,b,d)},a.prototype.listen=function(a){return this.listenCallback=a,this.bindEventListener()},a.prototype.onMessage=function(a){var b;return b=this.parseEvent(a),console.log("onMessage"),console.log(b),this.listenCallback(b)},a.prototype.parseEvent=function(a){return new b(a)},a.prototype.bindEventListener=function(){if(typeof window.addEventListener!="undefined")return window.addEventListener("message",this.onMessage,!1);if(typeof window.attachEvent!="undefined")return window.attachEvent("onmessage",this.onMessage)},a}(),window||(window={}),window.Postie=a,b=function(){function a(a){var b;if(!a)throw"Cannot construct a PostieEvent with a postMessage event object";this.origin=a.origin,b=JSON.parse(a.data),this.uuid=b.uuid,this.data=b.payload,this.sourceWindow=a.source,this.respond(),this}return a.prototype.success=!1,a.prototype.respond=function(){var a;return a=new c(this.sourceWindow,this.response()),console.log("respond..."),console.log(a),console.log(a.frame.name),console.log(a.frame.postMessage),a},a.prototype.response=function(){return{success:!0}},a}(),c=function(){function a(a,b,c){this.frame=a,this.data=b,c==null&&(c={}),this.parseFrame(),this.dispatch(),c.callback&&c.callback()}return a.prototype.allowedDomains=["*"],a.prototype.uuid=null,a.prototype.parseFrame=function(){if(typeof this.frame=="string")return this.frame=document.getElementById(this.frame);typeof this.frame.contentWindow=="object"&&(this.frame=this.frame.contentWindow);try{if(typeof this.frame.postMessage=="function")return this.frame}catch(a){return console.log("Could not call postMessage on: "+a)}},a.prototype.payload=function(){var a;try{return a={uuid:this.generateUuid(),payload:this.data},JSON.stringify(a)}catch(b){return console.log("Could not stringify data: "+this.data+" with "+b)}},a.prototype.dispatch=function(){return console.log(this.frame.name),console.log(this.payload()),console.log(this.domains()),this.frame.postMessage(this.payload(),this.domains())},a.prototype.domains=function(a){var b;return a==null&&(a={}),b=a.domains||this.allowedDomains,b.join(", ")},a.prototype.generateUuid=function(){var a;return this.uuid?this.uuid:(a=function(){return((1+Math.random())*65536|0).toString(16).substring(1)},this.uuid=""+a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a())},a}()})).call(this);